@model Student_Performance_Management_System.ViewModel.StaffDashViewModel;
@{
    Layout = "_StaffLayout";
}

<div class="container-fluid py-4">
    <!-- Header Section -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h2 class="fw-bold text-dark mb-1">My Assigned Tasks</h2>
            <p class="text-muted small">Status Overview for Academic Session @DateTime.Now.Year</p>
        </div>
    </div>

    <!-- Tasks Table Card -->
    <div class="card border-0 shadow-sm rounded-4 overflow-hidden">
        <div class="table-responsive">
            <table class="table table-hover align-middle mb-0">
                <thead class="bg-light">
                    <tr>
                        <th class="ps-4 py-3">Course & Subject</th>
                        <th>Group</th>
                        <th>Timeline</th>
                        <th>Task Status</th> @* Status Column *@
                        <th class="text-center">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var item in Model.Tasks)
                    {
                        <tr>
                            <td class="ps-4">
                                <div class="fw-bold text-primary">@item.Course.CourseName</div>
                                <div class="small text-muted">@item.Subject.SubjectName</div>
                            </td>
                            <td>
                                <span class="badge bg-light text-dark border px-3">
                                    @item.CourseGroup.GroupName
                                </span>
                            </td>
                            <td>
                                <div class="small fw-bold text-dark">Due: @item.ValidTo.ToString("dd MMM yyyy")</div>
                                <div class="text-muted small">From: @item.ValidFrom.ToString("dd MMM")</div>
                            </td>
                            <td>
                                @* --- Enum Status Logic (0=Pending, 1=Completed, 2=Overdue) --- *@
                                @switch (item.Status)
                                {
                                    case Status.Pending:
                                        <span class="badge rounded-pill bg-warning-subtle text-warning border border-warning-subtle px-3 py-2">
                                            <i class="bi bi-clock-history me-1"></i> Pending
                                        </span>
                                        break;
                                    case Status.Completed:
                                        <span class="badge rounded-pill bg-success-subtle text-success border border-success-subtle px-3 py-2">
                                            <i class="bi bi-check-circle-fill me-1"></i> Completed
                                        </span>
                                        break;
                                    case Status.Overdue:
                                        <span class="badge rounded-pill bg-danger-subtle text-danger border border-danger-subtle px-3 py-2">
                                            <i class="bi bi-exclamation-triangle-fill me-1"></i> Overdue
                                        </span>
                                        break;
                                }
                            </td>
                            <td class="text-center">
                                <div class="btn-group gap-2">
                            <td class="text-center">
                                <div class="btn-group gap-2">

                                    @if (item.Status == Status.Pending)
                                    {
                                        <a href="/Staff/AddMark/@item.TasksId"
                                           class="btn btn-sm btn-primary rounded-pill px-3">
                                            Add Marks
                                        </a>
                                    }

                                    else if (item.Status == Status.Overdue)
                                    {
                                        <a asp-action="SendLateRequest"
                                           asp-route-id="@item.TasksId"
                                           class="btn btn-sm btn-outline-danger rounded-pill px-3">
                                            Request Extension
                                        </a>
                                    }

                                    else if (item.Status == Status.LateRequested)
                                    {
                                        <span class="badge bg-warning rounded-pill px-3 py-2">
                                            <i class="bi bi-hourglass-split me-1"></i> Requested
                                        </span>

                                        <button class="btn btn-sm btn-light rounded-pill px-3" disabled>
                                            <i class="bi bi-lock-fill"></i> Locked
                                        </button>
                                    }

                                    else if (item.Status == Status.LateRejected)
                                    {
                                        <span class="badge bg-danger rounded-pill px-3 py-2">
                                            <i class="bi bi-x-circle me-1"></i> Rejected
                                        </span>

                                        <button class="btn btn-sm btn-light rounded-pill px-3" disabled>
                                            <i class="bi bi-lock-fill"></i> Locked
                                        </button>
                                    }

                                    else if (item.Status == Status.Completed)
                                    {
                                        <span class="badge bg-success rounded-pill px-3 py-2">
                                            <i class="bi bi-check-circle-fill me-1"></i> Completed
                                        </span>

                                        <button class="btn btn-sm btn-light rounded-pill px-3" disabled>
                                            <i class="bi bi-lock-fill"></i> Locked
                                        </button>
                                    }
                                </div>
                            </td>


            </div>
            </td>
            </tr>
        }
        </tbody>
        </table>
    </div>
</div>
</div>